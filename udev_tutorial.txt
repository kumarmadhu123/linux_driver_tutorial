Udev 

udev is a userspace system that enables the operating system administrator to register userspace handlers for events. The events received by udev's daemon are mainly generated by the (Linux) kernel in response to physical events relating to peripheral devices. 

Exercise :
An exercise to create a userspace message when a USB plugins

Create a script trigger.sh

#!/usr/bin/bash


/usr/bin/date >> /tmp/udev.log
echo “USB Activity detected”


Move this script to /usr/local/bin/trigger.sh . Trigger.sh will only copy the date and the message “USB Activity detected” when a USB thumb drive is activated.

Check the activity in the udevadm monitor
sudo udevadm info -a -n /dev/sdb | less

Udevadm info starts with the device specified by the devpath and then
walks up the chain of parent devices. It prints for every device
found, all possible attributes in the udev rules key format.
A rule to match, can be composed by the attributes of the device
and the attributes from one single parent device.

  looking at device '/devices/pci0000:00/0000:00:14.0/usb1/1-1/1-1:1.0/host2/target2:0:0/2:0:0:0/block/sdb':
    KERNEL=="sdb"
    SUBSYSTEM=="block"
    DRIVER==""
    ATTR{range}=="16"
    ATTR{events_poll_msecs}=="-1"
    ATTR{discard_alignment}=="0"
    ATTR{ext_range}=="256"
    ATTR{inflight}=="       0        0"
    ATTR{removable}=="1"
    ATTR{alignment_offset}=="0"
    ATTR{events}=="media_change"
    ATTR{events_async}==""
    ATTR{hidden}=="0"
    ATTR{stat}=="     112       28     4380      224        0        0        0        0        0      188      224        0        0        0        0        0        0"
    ATTR{size}=="61341696"
    ATTR{capability}=="51"
    ATTR{ro}=="0"

  looking at parent device '/devices/pci0000:00/0000:00:14.0/usb1/1-1/1-1:1.0/host2/target2:0:0/2:0:0:0':
    KERNELS=="2:0:0:0"
    SUBSYSTEMS=="scsi"
    DRIVERS=="sd"
    ATTRS{eh_timeout}=="10"
    ATTRS{queue_depth}=="1"
    ATTRS{timeout}=="30"
    ATTRS{iorequest_cnt}=="0xba"





Create a file /etc/udev/rules.d/80-local.rules and add below . What action you are wishing to monitor and what you want to execute. 

SUBSYSTEM=="block", ACTION=="add", RUN+="/usr/local/bin/trigger.sh"



Either reboot your system or udevadm control --reload .

Now plug and unplug a USB thumb drive
msk@inspiron:~$ cat /tmp/udev.log
Fri Apr 15 13:17:00 IST 2022
Fri Apr 15 13:19:25 IST 2022
Fri Apr 15 13:19:26 IST 2022
Fri Apr 15 13:24:34 IST 2022
Fri Apr 15 13:24:34 IST 2022
Fri Apr 15 13:25:48 IST 2022
USB Activity detected
Fri Apr 15 13:25:48 IST 2022
USB Activity detected
Fri Apr 15 13:26:07 IST 2022
USB Activity detected
Fri Apr 15 13:26:07 IST 2022
USB Activity detected
msk@inspiron:~$

